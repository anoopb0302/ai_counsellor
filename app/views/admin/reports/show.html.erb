<!-- app/views/admin/reports/show.html.erb -->
<h1 class="text-2xl font-bold mb-4">Chat Session: <%= params[:id] %></h1>

<!-- Summary -->
<div class="mb-6 p-4 bg-yellow-50 border border-yellow-300 rounded">
  <h2 class="font-semibold mb-2">Summary</h2>
  <p class="text-gray-800 whitespace-pre-wrap"><%= @summary.presence || "– No summary available –" %></p>
</div>

<!-- Facts -->
<% facts = JSON.parse($redis.get("chat_facts:#{params[:id]}") || "{}") %>
<% if facts.any? %>
  <div class="mb-6 p-4 bg-gray-50 border rounded">
    <h2 class="font-semibold mb-2">Student Facts</h2>
    <dl class="grid grid-cols-2 gap-2 text-sm">
      <% facts.each do |key, value| %>
        <dt class="font-medium capitalize"><%= key.gsub("_", " ") %>:</dt>
        <dd class="text-gray-700"><%= value %></dd>
      <% end %>
    </dl>
  </div>
<% end %>

<!-- Sentiment -->
<% sentiment = JSON.parse($redis.get("chat_sentiment:#{params[:id]}") || "{}") %>
<% if sentiment.any? %>
  <div class="mb-6 p-4 bg-blue-50 border rounded">
    <h2 class="font-semibold mb-2">Sentiment</h2>
    <p class="text-sm">
      <strong>Label:</strong>
      <span class="inline-block px-2 py-1 text-xs rounded 
        <%= case sentiment["label"]
            when "POSITIVE" then 'bg-green-100 text-green-800'
            when "NEGATIVE" then 'bg-red-100 text-red-800'
            else 'bg-gray-100 text-gray-800'
            end %>">
        <%= sentiment["label"] %> (<%= sentiment["score"] %>%)
      </span>
    </p>
    <p class="mt-2 text-gray-700"><strong>Summary:</strong> <%= sentiment["summary"] %></p>
  </div>
<% end %>

<!-- Chat -->
<h2 class="text-xl font-semibold mb-2">Conversation</h2>
<div class="space-y-4">
  <% @chat_log.each do |entry| %>
    <div class="p-3 rounded border bg-white shadow-sm">
      <p><strong>Student:</strong> <%= entry["query"] %></p>
      <% if entry["response"].present? %>
        <p class="mt-1"><strong>Counselor:</strong> <%= entry["response"] %></p>
      <% end %>
    </div>
  <% end %>
</div>

<%= link_to "← Back", admin_reports_path, class: "mt-6 inline-block text-blue-600 hover:underline" %>
